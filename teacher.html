<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¤ëŠ˜ í•  ì¼</title>

  <!-- í°íŠ¸: SUIT -->
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/variable/woff2/SUIT.css">

  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

  
  <link rel="stylesheet" href="css/common.css">
  <script src="js/common.js"></script>
  <script src="js/challenges.js"></script>

  <style>
    *{ box-sizing:border-box }
    html, body { min-height:100% }

    /* ================================
       ë°°ê²½ & ê¸°ë³¸ íƒ€ì´í¬
       ================================ */
    body{
      margin:0;
      font-family:'SUIT',system-ui,-apple-system,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
      color:var(--text);

      /* ë¶€ë“œëŸ¬ìš´ ë°°ê²½ ê·¸ë˜í”½ */
      background:
        radial-gradient(820px 340px at 108% 0%, var(--bg-mint), transparent 62%),
        linear-gradient(180deg, var(--bg-base), var(--bg-base));

      /* ìƒë‹¨ ë¡œê³ ì¹© ê³µê°„ í™•ë³´ + ê°€ìš´ë° ì •ë ¬ */
      padding:96px 16px 40px;
      display:flex;
      justify-content:center;
      align-items:flex-start;   /* ì„¸ë¡œ ê°€ìš´ë° ê³ ì • ë°©ì§€ */
      overflow-y:auto;          /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
    }

    /* ë°°ê²½ì˜ êµ¬ë¦„ */
    body::before{
      content:"";
      position:fixed; inset:0; z-index:-1; pointer-events:none; opacity:.9;
      background:
        radial-gradient(200px 80px at 16% 30%, #fff 60%, transparent 61%),
        radial-gradient(150px 60px at 27% 26%, #fff 60%, transparent 61%),
        radial-gradient(180px 70px at 77% 28%, #fff 60%, transparent 61%),
        radial-gradient(140px 60px at 88% 35%, #fff 60%, transparent 61%),
        radial-gradient(120px 50px at 12% 52%, #fff 60%, transparent 61%),
        radial-gradient(110px 45px at 92% 56%, #fff 60%, transparent 61%);
    }

    /* ================================
       ê°€ìš´ë° ì¹´ë“œ ì»¨í…Œì´ë„ˆ
       ================================ */
    .container{
       width:calc(100% - 40px);
      background:var(--card);
      border:1px solid var(--card-line);
      border-radius:26px;
      box-shadow:0 16px 40px rgba(0,0,0,.10);
      padding:28px 24px 32px;

      /* ê¸´ ë‚´ìš© ëŒ€ì‘ */
      height:auto;
      overflow-wrap:break-word;
    }

    /* ================================
       ê³µí†µ ì œëª©/ì„¹ì…˜
       ================================ */
    h2, h3 { margin:0 0 14px; }
    h2{
      text-align:center;
      font-family:'SUIT',system-ui,-apple-system,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;
      font-weight:500;
      letter-spacing:-.2px;
    }
    section{ margin-top:26px; }

    /* ================================
       ì…ë ¥/ì…€ë ‰íŠ¸/ë²„íŠ¼ ê³µí†µ
       ================================ */
    input[type="text"],
    input[type="password"],
    input[type="date"],
    select{
      padding:10px 12px;
      border:2px solid #dcdfe4;
      border-radius:14px;
      outline:none;
      font:inherit;
      background:#fff;
    }
    input:focus, select:focus{
      border-color:#b9c7c5;
      box-shadow:0 0 0 4px rgba(185,199,197,.28);
    }
    button{
      padding:10px 14px;
      cursor:pointer;
      border-radius:14px;
      border:1px solid var(--card-line);
      background:#fff;
      font:inherit;
    }
    .btn-primary{
      color:#fff;
      background:var(--brand);
      border-color:var(--brand);
      box-shadow:0 12px 28px var(--btn-shadow);
    }

    /* ================================
       ê³¼ì œ ì…ë ¥ í–‰
       ================================ */
    .task-input{
      display:flex;
      gap:8px;
      margin-bottom:10px;
    }
    .task-input input{ flex:1; }

    /* í•™ìƒ ì²´í¬ë°•ìŠ¤ ë¼ë²¨ */
    .student-checkboxes label{
      display:inline-block;
      margin:6px 8px 0 0;
      padding:6px 10px;
      border:1px solid #e6e8eb;
      border-radius:12px;
      background:#fff;
    }

    /* ì €ì¥ë‚´ì—­/í•™ìƒì¹© */
    .saved-item, .student-item{
      border-top:1px dashed #d5d5d5;
      padding-top:8px;
      margin-top:10px;
    }

    /* ì¢…ë¥˜ í† ê¸€ */
    .type-toggle{ display:flex; gap:6px; align-items:center; }
    .type-toggle button{
      height:36px; padding:0 12px; border-radius:12px;
      border:1px solid var(--card-line); background:#fff; cursor:pointer;
    }
    .type-toggle button.is-active{
      background:var(--brand); color:#fff; border-color:var(--brand);
    }

    /* ë°˜ë³µ ë²”ìœ„ */
    .repeat-range{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .repeat-range input{ height:40px; padding:6px 10px; border:2px solid #dcdfe4; border-radius:12px; }

    /* ì„¤ëª… */
    .desc-wrap{ display:flex; flex-direction:column; gap:8px; }
    .task-desc{
      width:100%; border:2px solid #dcdfe4; border-radius:12px; padding:10px; resize:vertical;
    }

    /* í•™ìƒ ì¹´ë“œ í† ê¸€ */
    .student-card-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap:10px;
      margin-top:8px;
    }
    .student-card{
      background:#fff;
      border:1px solid #e6e8eb;
      border-radius:16px;
      padding:12px;
      box-shadow:0 4px 10px rgba(0,0,0,.04);
      cursor:pointer;
      user-select:none;
    }
    .student-card.is-selected{
      background:#2e7d57; color:#fff; border-color:#2e7d57;
    }

    /* ë‹¬ë ¥ pill ìƒíƒœ  */
    .task-pill{ background:#fff; border-radius:10px; padding:4px 8px; margin-top:6px;
               font-size:12px; cursor:pointer; display:inline-block; border:1px solid rgba(0,0,0,.06); }
    .task-pill.pending{ background:#f6c1c1; border-color:#e9b3b3; }
    .task-pill.done{ background:#fff; border-color:#dfe3e6; }
    .task-pill:hover{ opacity:.9; }

    .event-pill{
      margin-top:6px;
      font-size:12px;
      cursor:pointer;
      display:inline-block;
    }
    /* ================================
       ë‹¬ë ¥ ìŠ¤íƒ€ì¼
       ================================ */
    .calendar{ display:none; }
    .calendar table{
      width:100%;
      border-collapse:collapse;
      margin-top:14px;
      background:#fff;
      border-radius:14px;
      overflow:hidden;
    }
    .calendar th, .calendar td{
      border:1px solid #ececec;
      width:14.28%;
      height:96px;
      text-align:left;
      vertical-align:top;
      padding:8px;
      font-size:14px;
    }
    .calendar thead th{ background:#f9fafb; }
    .calendar td > strong{ display:block; margin-bottom:6px; }
    
    /* ìš”ì¼ í—¤ë” ê°€ìš´ë° ì •ë ¬ + ë†’ì´ ì¤„ì´ê¸° */
    .calendar thead th{
      text-align:center;
      height: 36px;            /* ê¸°ì¡´ë³´ë‹¤ ë‚®ê²Œ */
      padding: 6px 0;          /* íšŒìƒ‰ì¹¸ ë†’ì´ ì¶•ì†Œ */
      vertical-align:middle;
    }
    
    /* ì£¼ë§ ìš”ì¼ ë¹¨ê°„ìƒ‰ */
    .calendar thead th.sat,
    .calendar thead th.sun{
      color:#d33;              /* ë¹¨ê°„ìƒ‰ */
      font-weight:600;
    }
    
    /* ë‚ ì§œ ìˆ«ì(ì™¼ìª½ êµµì€ ìˆ«ì) ìŠ¤íƒ€ì¼ */
    .calendar td > strong{
      display:inline-block;
      margin-right:6px;
    }
    
    /* í† /ì¼(weekend), ê³µíœ´ì¼, ë°©í•™ì¸ ë‚ ì˜ 'ìˆ«ì' ë¹¨ê°„ìƒ‰ */
    .calendar td.weekend > strong,
    .calendar td.holiday > strong,
    .calendar td.vacation > strong{
      color:#d33;
    }
    
    /* ê³µíœ´ì¼/ë°©í•™ ë¼ë²¨ (ìˆ«ì ì˜†ì— ë¶™ëŠ” í…ìŠ¤íŠ¸) */
    .calendar .day-label{
      font-size:12px;
      font-weight:600;
      color:#d33;
      margin-left:4px;
      white-space:nowrap;
    }

    /* ì„ íƒ ì•ˆë‚´/ë²„íŠ¼ ì˜ì—­ */
    #task-action-selected{ margin:10px 0; font-size:14px; color:#555; }

    /* ================================
       ê³¼ì œë³„ ì™„ë£Œ ì—¬ë¶€(ì¹©)
       ================================ */
    .student-chip-grid{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .student-chip{
      border:1px solid #e6e8eb;
      border-radius:12px;
      padding:10px 12px;
      min-width:92px;
      text-align:center;
      background:#fff;
    }
    .student-chip.missed{
      background:#f6c1c1;
      border-color:#e9b3b3;
    }

    .student-chip.postponed{
      background:#fddf7f;
      border-color:#f0c24c;
      color:#604400;
    }


    /* ================================
       ë„ì „ ê´€ë¦¬
       ================================ */
    #challenge-list .chl-item{ position:relative; display:flex; justify-content:space-between; gap:12px; border:1px solid #e5e7eb; border-radius:14px; padding:12px 14px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.04); margin-bottom:10px; cursor:pointer; transition:box-shadow .2s ease, transform .2s ease; }
    #challenge-list .chl-item:hover{ box-shadow:0 6px 18px rgba(0,0,0,.08); transform:translateY(-2px); }
    #challenge-list .chl-item.inactive{ opacity:.7; }
    .chl-{ font-weight:700; margin-bottom:6px; }
    .chl-desc{ font-size:14px; color:#475467; margin-bottom:6px; }
    .chl-meta{ font-size:12px; color:#667085; }
    .chl-actions button{ margin-left:6px; }
    .chl-actions .danger{ color:#b42318; }
    .muted{ color:#667085; }
    #challenge-list .chl-item button{ position:relative; z-index:1; }

    #challenge-status-view .st-student-grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(240px, 1fr)); gap:12px; margin-top:16px; }
    #challenge-status-view .challenge-card{ border:1px solid #e5e7eb; border-radius:14px; padding:14px 16px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.04); color:#101828; }
    #challenge-status-view .challenge-card .ch-progress{ position:relative; width:100%; height:14px; border-radius:999px; background:#edf1f4; overflow:hidden; margin-bottom:12px; }
    #challenge-status-view .challenge-card .ch-progress-fill{ position:absolute; inset:0; width:var(--prog,0%); background:linear-gradient(90deg, #2e7d57, #4bb27d); transition:width .3s ease; }
    #challenge-status-view .challenge-card .ch-title{ font-weight:700; margin-bottom:6px; }
    #challenge-status-view .challenge-card .ch-state{ font-size:14px; color:#344054; }
    #challenge-status-view .challenge-card .ch-next{ font-size:12px; color:#667085; margin-top:6px; }
    #challenge-status-view .challenge-card .ch-controls{ display:flex; flex-wrap:wrap; gap:6px; margin-top:12px; }
    #challenge-status-view .challenge-card .ch-controls button{ flex:1; min-width:96px; padding:8px 10px; border-radius:10px; border:1px solid #d0d5dd; background:#f9fafb; font-size:13px; }
    #challenge-status-view .challenge-card .ch-controls button:hover{ background:#eef2f6; }
    

    /* ================================
       í•™ìƒ ê´€ë¦¬ í‘œ
       ================================ */
    #student-list{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    #student-list col:nth-child(1){ width: 8ch; }
    #student-list col:nth-child(2){
      width:auto;
      min-width: 14rem;
    }
    #student-list col:nth-child(3){ width: 14ch; }
    #student-list col:nth-child(4){ width: 7ch;  }
    #student-list col:nth-child(5){ width: 16ch; }

    #student-list th, #student-list td{
      border:1px solid #ccc;
      padding:6px;
      text-align:center;
      vertical-align:middle;
    }
   
    /* í‘œ ì•ˆ ì…ë ¥ì¹¸ ë‘¥ê¸€ê²Œ + ë™ì¼ ìŠ¤íƒ€ì¼ */
    #student-list td input[data-field="id"],
    #student-list td input[data-field="name"],
    #student-list td input[data-field="password"]{
      width:100%;
      height:36px;             
      padding:6px 10px;
      border:2px solid #dcdfe4;
      border-radius:14px;        /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
      background:#fff;
      box-sizing:border-box;
      display:block;
      margin:0;
    }
    #student-list td.col-actions .actions{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:8px;
    }
    /* ë²ˆí˜¸ ì…ë ¥ì€ ê°€ìš´ë° ì •ë ¬*/
    #student-list td input[data-field="id"]{
      text-align:center;
    }
    #student-list td.col-actions .actions button{
      height:32px;
      padding:0 12px;
    }
    @media (max-width: 520px){
      #student-list col:nth-child(4){ width: 6ch; }
      #student-list col:nth-child(5){ width: 14ch; }
    }
    .table-wrap{ overflow-x:auto; }

    /* ë²„íŠ¼ ì¤„ í•œ ì¤„ ì •ë ¬ */
    #task-action-buttons{
      display:none;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    #task-action-buttons button{
      height:36px;
      padding:0 14px;
    }
    
    /* í† /ì¼ & ê³µíœ´ì¼/ë°©í•™ í‘œì‹œìš© */
    .calendar td .day-num { font-weight:600; }
    .calendar td.sun  .day-num,
    .calendar td.sat  .day-num { color:#d74b4b; }     /* ì£¼ë§ ë¹¨ê°• */
    .calendar td.holiday .day-num,
    .calendar td.vacation .day-num { color:#d74b4b; } /* ê³µíœ´ì¼/ë°©í•™ ë¹¨ê°• */

    .calendar td.drag-target {
      outline:2px dashed var(--brand);
      background:rgba(86, 178, 146, 0.12);
    }
    .calendar td.drag-origin {
      opacity:0.6;
    }
   
    .badge-holiday, .badge-vacation{
      display:inline-block;
      margin-left:6px;
      font-size:12px;
      padding:0;                 /* ì—¬ë°± ì œê±° */
      border-radius:0;           /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ì œê±° */
      background:transparent;    /* ë°°ê²½ ì œê±° */
      color:#d33;                /* ê¸€ìë§Œ ë¹¨ê°„ìƒ‰ */
      font-weight:600;           /* ì¡°ê¸ˆ êµµê²Œ(ì„ íƒ) */
      border:none;               /* í˜¹ì‹œ ëª¨ë¥¼ í…Œë‘ë¦¬ ì œê±° */
      box-shadow:none;           /* ê·¸ë¦¼ì ì œê±° */
    }
    /* (ì„ íƒ) í† /ì¼ ìš”ì¼ ë¨¸ë¦¬ê¸€ë„ ë¹¨ê°„ìƒ‰ */
    .calendar thead th:nth-child(6),
    .calendar thead th:nth-child(7) { color:#d74b4b; }
    
    /* ===== í•™ìƒ ì¶”ê°€ ì˜ì—­ ì¼ë ¬ ì •ë ¬ & í†µì¼ ===== */
    .teacher-page { --ctrl-h: 36px; }
    
    .add-student-row {
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:10px;
      flex-wrap:nowrap;
    }
    
    .add-student-row input {
      height:var(--ctrl-h);
      padding:6px 10px;
      border:2px solid #dcdfe4;
      border-radius:12px;
      font:inherit;
      background:#fff;
      box-sizing:border-box;
    }
    
    /* ê° ì…ë ¥ì¹¸ í­ */
    #new-student-id { width:72px; text-align:center; }
    #new-student-name { flex:1 1 200px; min-width:140px; }
    #new-student-password { width:160px; }

    .gender-toggle-btn {
      height:var(--ctrl-h);
      padding:0 16px;
      border-radius:12px;
      border:1px solid var(--card-line);
      background:#fff;
      cursor:pointer;
      font:inherit;
      min-width:70px;
      transition:background-color .2s ease, color .2s ease, border-color .2s ease;
    }
    .gender-toggle-btn.is-female {
      background:#fde2f3;
      border-color:#f9a8d4;
      color:#be185d;
    }
    #student-list .gender-toggle-btn {
      height:32px;
      padding:0 14px;
      border-radius:10px;
      font-size:15px;
      min-width:64px;
    }
    
    /* ì¶”ê°€ ë²„íŠ¼ í†µì¼ */
    .add-student-row button {
      height:var(--ctrl-h);
      border-radius:12px;
      padding:0 16px;
    }

    /* ì ‘ê·¼ì„± ìˆ¨ê¹€ ë¼ë²¨(ì•„ì´ì½˜ë§Œ ì“°ëŠ” ê³³) */
.sr { position: absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }

/* ë‘ ì¤„ í¼ ë ˆì´ì•„ì›ƒ */
.task-form { display:flex; flex-direction:column; gap:12px; }

/* ê° ì¤„ ê³µí†µ */
.task-row {
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;           /* ì¢ì€ í™”ë©´ì—ì„œ ìë™ ì¤„ë°”ê¿ˆ */
}

/* 1ì¤„: ë‚ ì§œëŠ” ì§§ê²Œ, í• ì¼ ì…ë ¥ì€ ê¸¸ê²Œ */
.task-row.row-1 #task-date { flex:0 0 180px; height:40px; }
.task-row.row-1 .task-list.inline { flex:1 1 auto; min-width:260px; }

/* task-list ë‚´ë¶€ ì…ë ¥í–‰ì€ ì„¸ë¡œë¡œ ìŒ“ì„ */
.task-list.inline { display:flex; flex-direction:column; gap:8px; }
.task-input { display:flex; gap:8px; }
.task-input input { flex:1 1 auto; height:40px; }
.task-input button { height:40px; padding:0 12px; }

/* 2ì¤„: select í¬ê¸° í†µì¼ */
.task-row.row-2 select { height:40px; min-width:160px; }

/* ë²„íŠ¼ í†µì¼ */
.task-row button { height:40px; padding:0 14px; border-radius:14px; border:1px solid var(--card-line); }
.btn-secondary { background:#f3f4f6; }
.btn-primary   { background:var(--brand); color:#fff; border-color:var(--brand); box-shadow:0 12px 28px var(--btn-shadow); }

    /* ëª¨ë°”ì¼ì—ì„œ 1ì—´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë–¨ì–´ì§€ë„ë¡ */
@media (max-width: 560px){
  .task-row.row-1 #task-date { flex:0 0 140px; }
  .task-row.row-2 { gap:10px; }
}

/* ================================
       ê´€ì°° ê¸°ë¡
       ================================ */
    .obs-form,
    .obs-filters{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .obs-grid{
      display:grid;
      gap:10px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      align-items:end;
    }
    .obs-grid .full{
      grid-column: 1 / -1;
    }
    .obs-card{
      border:1px solid #e6e8eb;
      border-radius:16px;
      padding:12px;
      background:#fff;
      box-shadow:0 4px 10px rgba(0,0,0,.04);
    }
    .obs-list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .obs-item{
      display:grid;
      gap:8px;
      grid-template-columns: 120px 1fr 120px 120px 140px;
      align-items:center;
      border:1px solid #e6e8eb;
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
    }
    .obs-item .meta{
      font-size:13px;
      color:#555;
    }
    .obs-item .note{
      font-size:14px;
      line-height:1.4;
    }
    .obs-item .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid #e6e8eb;
      font-size:12px;
      background:#f6f7f8;
    }
    .obs-item button{
      justify-self:end;
    }
    @media (max-width: 720px){
      .obs-item{
        grid-template-columns: 1fr;
        align-items:flex-start;
      }
      .obs-item button{
        justify-self:start;
      }
    }

    

    
  </style>
</head>
<body data-role="teacher" class="teacher-page">
  <!-- ìƒë‹¨ í’€ë°”(ì¹© ë²„íŠ¼í˜•) -->
  <header class="topbar">
    <div class="logo-area">
      <a href="./"><img src="logo.png" alt="ì˜¤ëŠ˜ í•  ì¼ ë¡œê³ "></a>
    </div>
    <nav class="menu-area" aria-label="ì£¼ìš” ë©”ë‰´">
      <button id="tab-status">ì˜¤ëŠ˜ í•  ì¼</button>
      <button id="tab-task">ê³¼ì œ</button>
      <button id="tab-challenges">ë„ì „</button>
      <button id="tab-observation">ê´€ì°° ê¸°ë¡</button>
      <button type="button" id="tab-tools">ë„êµ¬</button>
      <button id="tab-student">í•™ìƒ</button>
    </nav>
    <div class="right-tools">
      <button type="button" id="eventsBtn" class="mode-btn" aria-pressed="false">ì¼ì •ìˆ¨ê¹€</button>
      <button type="button" id="compactBtn" class="mode-btn" aria-pressed="false"></button>
      <button type="button" id="peToggleBtn" class="mode-btn" aria-pressed="false"></button>
      <button type="button" id="modeBtn" class="mode-btn" aria-pressed="false"></button>
    </div>
  </header>

  <!-- =====================================
       ê°€ìš´ë° ì¹´ë“œ ì»¨í…Œì´ë„ˆ
       ===================================== -->
  <div class="container" id="main-box">
    <!-- ===== ì˜¤ëŠ˜ í•  ì¼(í•™ìƒë³„ í˜„í™©) ===== -->
    <div id="student-status-page" style="display:none; margin-top: 8px;">
      <div id="events-strip-teacher" class="event-grid"></div>
      <div
        id="student-status-list"
      ></div>
    </div>

    <!-- ===== ê³¼ì œ ê´€ë¦¬ + ë‹¬ë ¥ ===== -->
    <div id="task-management" style="display:none; margin-top: 8px;">
      
      <!-- ê³¼ì œ ì…ë ¥ ì˜ì—­ -->
      <section class="task-form">
        <!-- 1ì¤„: ë‚ ì§œ + í•  ì¼ ì…ë ¥(ê¸¸ê²Œ) + í•  ì¼ ì¶”ê°€ ë²„íŠ¼ -->
        <div class="task-row row-1">
        
          <!-- ì¢…ë¥˜ í† ê¸€ -->
          <div id="task-type-toggle" class="type-toggle" role="tablist" aria-label="ì¢…ë¥˜ ì„ íƒ">
            <button type="button" data-type="event" aria-pressed="false">ì¼ì •</button>
            <button type="button" data-type="assignment" aria-pressed="true" class="is-active">ê³¼ì œ</button>
            <input type="hidden" id="task-type" value="assignment">
          </div>
          
          <label for="task-date" class="sr">ğŸ“… ë‚ ì§œ</label>
          <input type="text" id="task-date" inputmode="none" autocomplete="off" />
          
          <div id="task-list" class="task-list inline">
            <div class="task-input">
              <input type="text" placeholder="í•  ì¼ ì…ë ¥" />
              <button type="button" class="task-remove-btn" aria-label="í•  ì¼ ì‚­ì œ">âŠ–</button>
            </div>
          </div>
          
          <button type="button" class="btn-secondary" id="task-add-btn">+ í•  ì¼ ì¶”ê°€</button>
        </div>

        <!-- ì„¤ëª… í† ê¸€ & ì…ë ¥ -->
        <div class="desc-wrap">
          <button type="button" id="desc-toggle" class="btn-secondary">ì„¤ëª… ì¶”ê°€</button>
          <textarea id="task-desc" class="task-desc" rows="3" placeholder="(ì„ íƒ) ì°¸ê³ ìë£Œ/í†µê³¼ê¸°ì¤€ ë“±" style="display:none;"></textarea>
        </div>
        
        <!-- 2ì¤„: ë°˜ë³µ ì„¤ì • + ëŒ€ìƒ ì„ íƒ + ì €ì¥ -->
        <div class="task-row row-2">
          <label for="repeat">ğŸ” ë°˜ë³µ ì„¤ì •</label>
          
          <select id="repeat">
            <option value="none">ì—†ìŒ</option>
            <option value="daily">ë§¤ì¼</option>
            <option value="mon">ë§¤ì£¼ ì›”ìš”ì¼</option>
            <option value="tue">ë§¤ì£¼ í™”ìš”ì¼</option>
            <option value="wed">ë§¤ì£¼ ìˆ˜ìš”ì¼</option>
            <option value="thu">ë§¤ì£¼ ëª©ìš”ì¼</option>
            <option value="fri">ë§¤ì£¼ ê¸ˆìš”ì¼</option>
          </select>

          <!-- ë°˜ë³µ ë²”ìœ„ (ë°˜ë³µ ì„ íƒ ì‹œ ë³´ì´ê¸°) -->
          <div id="repeat-range" class="repeat-range" style="display:none;">
            <label for="task-start">ì‹œì‘</label>
            <input type="text" id="task-start" inputmode="none" placeholder="YYYY-MM-DD (ìš”ì¼)">
            <label for="task-end">ì¢…ë£Œ</label>
            <input type="text" id="task-end" inputmode="none" placeholder="ì„ íƒ(ì—†ìœ¼ë©´ ë¬´ê¸°í•œ)">
          </div>
          
          <label for="target">ğŸ‘¥ ëŒ€ìƒ ì„ íƒ</label>
          <select id="target">
            <option value="all">ì „ì²´ í•™ìƒ</option>
            <option value="selected">íŠ¹ì • í•™ìƒ ì§€ì •</option>
          </select>
          
          <button type="button" class="btn-primary" id="task-save-btn">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
        </div>
        
        <!-- íŠ¹ì • í•™ìƒ ì§€ì •: ì¹´ë“œ í† ê¸€ -->
        <div id="student-selector" class="student-card-grid" style="display:none;"></div>
      </section>


      <!-- ë‹¬ë ¥ -->
      <section class="calendar" style="margin-top:20px;">

        <div id="cal-controls" style="display:flex;align-items:center;gap:8px;margin:8px 0 4px;">
          <button type="button" id="cal-prev">â—€</button>
          <div id="cal-label" style="font-weight:600;min-width:120px;text-align:center;"></div>
          <button type="button" id="cal-next">â–¶</button>
          <button type="button" id="cal-today" style="margin-left:8px;">ì˜¤ëŠ˜</button>
        </div>

        <table>
          <thead>
            <tr>
                <th class="mon">ì›”</th>
              <th class="tue">í™”</th>
              <th class="wed">ìˆ˜</th>
              <th class="thu">ëª©</th>
              <th class="fri">ê¸ˆ</th>
              <th class="sat">í† </th>
              <th class="sun">ì¼</th></tr>
          </thead>
          <tbody id="calendar-body"></tbody>
        </table>
      </section>
      
      <section style="margin-top:16px;">
        <h3>íœ´ì¼ ê´€ë¦¬</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <input type="text" id="vac-name" placeholder="ì˜ˆ: ì—¬ë¦„ë°©í•™" style="flex:1 1 180px;">
          <input type="date" id="vac-start">
          <input type="date" id="vac-end">
          <button class="btn-primary" id="vac-add-btn">ì¶”ê°€</button>
          <button id="vac-cancel-btn" style="display:none;">ì·¨ì†Œ</button>
        </div>
        <div id="vac-list" style="margin-top:10px;"></div>
      </section>

      <!-- ê³¼ì œ ì„ íƒ ì•ˆë‚´ + ì•¡ì…˜ ë²„íŠ¼ -->
      <div id="task-action-selected"></div>
      <div id="task-action-buttons" style="margin-top:10px; display:none;">
        <button class="btn-primary" id="task-close-btn">ë‹«ê¸°</button>
        <button class="btn-primary" id="task-edit-btn">ìˆ˜ì •</button>
        <button class="btn-primary" id="task-delete-btn">ì‚­ì œ</button>
      </div>

      <!-- ê³¼ì œë³„ í•™ìƒ ì™„ë£Œ ì—¬ë¶€ -->
      <div id="task-completion" style="margin-top:20px; display:none;">
        <h3>ê³¼ì œë³„ í•™ìƒ ì™„ë£Œ ì—¬ë¶€</h3>
        <div id="completion-list"></div>
      </div>
    </div>

    <!-- ===== í•™ìƒ ê´€ë¦¬ ===== -->
    <div id="student-management" style="display:none; margin-top:20px;">

      <!-- í•™ìƒ ì¶”ê°€ í¼ -->
      <div class="add-student-row">
        <input type="text" id="new-student-id" placeholder="ë²ˆí˜¸">
        <input type="text" id="new-student-name" placeholder="ì´ë¦„">
        <button type="button" id="new-student-gender" class="gender-toggle-btn" data-gender="ë‚¨ì" aria-pressed="true">ë‚¨ì</button>
        <input type="password" id="new-student-password" placeholder="ë¹„ë°€ë²ˆí˜¸">
        <button type="button" class="btn-primary" id="add-student-btn">ì¶”ê°€</button>
      </div>

      <!-- ì „ì²´ ë¹„ë°€ë²ˆí˜¸ ë³´ê¸° í† ê¸€ -->
      <div style="display:flex; align-items:center; gap:12px; margin:8px 0;">
        <label>
          <input type="checkbox" id="show-all-passwords">
          ë¹„ë°€ë²ˆí˜¸ ëª¨ë‘ ë³´ê¸°
        </label>
      </div>

      <!-- í•™ìƒ ëª©ë¡ í‘œ -->
      <table id="student-list" border="1" style="margin-top:10px; width: 100%; border-collapse:collapse;">
        <colgroup>
          <col><!-- ë²ˆí˜¸ -->
          <col><!-- ì´ë¦„ -->
          <col><!-- ì„±ë³„ -->
          <col><!-- ë¹„ë°€ë²ˆí˜¸ -->
          <col><!-- ë³´ê¸° -->
          <col><!-- ì‘ì—… -->
        </colgroup>
        <thead>
          <tr>
            <th>ë²ˆí˜¸</th>
            <th>ì´ë¦„</th>
            <th>ì„±ë³„</th>
            <th>ë¹„ë°€ë²ˆí˜¸</th>
            <th>ë³´ê¸°</th>
            <th>ì‘ì—…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
    <!-- ===== ê´€ì°° ê¸°ë¡ ===== -->
    <div id="observation-management" style="display:none; margin-top:20px;">
      <section class="obs-form">
        <h3>ê´€ì°° ê¸°ë¡ ì¶”ê°€</h3>
        <div class="obs-grid">
          <label>
            í•™ìƒ
            <select id="obs-student"></select>
          </label>
          <label>
            ì¢…ë¥˜
            <select id="obs-type">
              <option value="ì¹­ì°¬">ì¹­ì°¬</option>
              <option value="ì¡°ì–¸">ì¡°ì–¸</option>
              <option value="ê¸°ë¡(0ì )">ê¸°ë¡(0ì )</option>
            </select>
          </label>
          <label>
            ëŠ¥ë ¥ì¹˜
            <select id="obs-ability">
              <option value="ì‹ ë¢°ë„">ì‹ ë¢°ë„</option>
              <option value="í˜¸ê°ë„">í˜¸ê°ë„</option>
              <option value="ì§‘ì¤‘ë ¥">ì§‘ì¤‘ë ¥</option>
              <option value="ìˆ™ë ¨ë„">ìˆ™ë ¨ë„</option>
              <option value="ì •ì‹ ë ¥">ì •ì‹ ë ¥</option>
            </select>
          </label>
          <label>
            ë‚ ì§œ
            <input type="date" id="obs-date" />
          </label>
          <label class="full">
            ë¬¸ì¥ í…œí”Œë¦¿
            <select id="obs-template"></select>
          </label>
          <label class="full">
            ììœ  ë©”ëª¨ (ì„ íƒ)
            <textarea id="obs-memo" rows="3" class="task-desc" placeholder="ë³´ì¶© ì„¤ëª…ì´ë‚˜ ìƒí™©ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
          </label>
        </div>
        <div>
          <button type="button" class="btn-primary" id="obs-add-btn">ê´€ì°° ê¸°ë¡ ì €ì¥</button>
        </div>
      </section>

      <section class="obs-filters" style="margin-top:20px;">
        <h3>ê´€ì°° ê¸°ë¡ ë³´ê¸°</h3>
        <div class="obs-grid">
          <label>
            ë‚ ì§œ
            <input type="date" id="obs-filter-date" />
          </label>
          <label>
            í•™ìƒ
            <select id="obs-filter-student"></select>
          </label>
          <label>
            ì¢…ë¥˜
            <select id="obs-filter-type">
              <option value="">ì „ì²´</option>
              <option value="ì¹­ì°¬">ì¹­ì°¬</option>
              <option value="ì¡°ì–¸">ì¡°ì–¸</option>
              <option value="ê¸°ë¡(0ì )">ê¸°ë¡(0ì )</option>
            </select>
          </label>
          <label>
            ëŠ¥ë ¥ì¹˜
            <select id="obs-filter-ability">
              <option value="">ì „ì²´</option>
              <option value="ì‹ ë¢°ë„">ì‹ ë¢°ë„</option>
              <option value="í˜¸ê°ë„">í˜¸ê°ë„</option>
              <option value="ì§‘ì¤‘ë ¥">ì§‘ì¤‘ë ¥</option>
              <option value="ìˆ™ë ¨ë„">ìˆ™ë ¨ë„</option>
              <option value="ì •ì‹ ë ¥">ì •ì‹ ë ¥</option>
            </select>
          </label>
          <label class="full">
            ê²€ìƒ‰
            <input type="text" id="obs-filter-search" placeholder="í•™ìƒ, í…œí”Œë¦¿, ë©”ëª¨ ê²€ìƒ‰" />
          </label>
        </div>
      </section>

      <section style="margin-top:16px;">
        <div id="obs-list" class="obs-list"></div>
      </section>
    </div>

  <!-- ===== ë„ì „ ê´€ë¦¬ ===== -->
<div class="container" id="challenges-box" style="display:none;">
  <div id="challenge-list-view">
    <div class="toolbar" style="display:flex;align-items:center;gap:8px;margin:8px 0;">
      <button type="button" id="challenges-new-btn">+ ìƒˆ ë„ì „</button>
      <input id="chl-search" placeholder="ê²€ìƒ‰ (ì œëª©/ì„¤ëª…)" style="flex:1;max-width:260px;" />
      <select id="chl-sort">
        <option value="name">ì´ë¦„ ìˆœ</option>
        <option value="incomplete">ë¯¸ì™„ë£Œ ë§ì€ ìˆœ</option>
        <option value="complete">ì™„ë£Œ ë§ì€ ìˆœ</option>
        <option value="progressHigh">ì§„í–‰ë„ ë†’ì€ ìˆœ</option>
        <option value="progressLow">ì§„í–‰ë¥  ë‚®ì€ ìˆœ</option>
      </select>
    </div>
    <div id="challenge-list"></div>
  </div>

  <section id="challenge-form" style="display:none;">
    <h3 style="margin:6px 0 12px;">ë„ì „ í¸ì§‘</h3>
    <label>ì œëª©<br><input id="chf-title" style="width:100%"></label>
    <br>
    <label>ì„¤ëª…<br><textarea id="chf-desc" style="width:100%;min-height:96px"></textarea></label>
      <br>
      <label>ë‹¨ê³„ ìˆ˜<br>
        <input id="chf-step-count" type="number" min="0" max="30" value="0" style="width:100%;">
      </label>
      <div id="chf-steps-box" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"></div>
      <br>
      <label><input type="checkbox" id="chf-active" checked> í™œì„±í™”</label>
      <br><br>
      <label>ëŒ€ìƒ<br>
        <select id="chf-target">
          <option value="all">ì „ì²´</option>
          <option value="selected">ì„ íƒ</option>
        </select>
      </label>
      <div id="chf-student-selector" class="student-card-grid" style="display:none;"></div>
      <div style="margin-top:12px;display:flex;gap:8px;">
        <button type="button" id="challenge-save-btn">ì €ì¥</button>
        <button type="button" id="challenge-cancel-btn">ì·¨ì†Œ</button>
      </div>
    </section>

  <section id="challenge-status-view" style="display:none;">
    <div class="st-header" style="display:flex;align-items:center;gap:8px;">
      <button type="button" id="challenge-back-btn">â† ë’¤ë¡œ</button>
      <strong class="st-ch-title"></strong>
      <span class="st-ch-active" style="color:#475467"></span>
    </div>
    <div class="st-actions" style="margin:10px 0;display:flex;gap:8px;">
      <button type="button" id="challenge-bulk-done">ëª¨ë‘ ì™„ë£Œ</button>
      <button type="button" id="challenge-bulk-undone">ëª¨ë‘ ë¯¸ì™„ë£Œ</button>
    </div>
    <div class="st-student-grid"></div>
  </section>
</div>

<script type="module" src="js/teacher-app.js"></script>
  <script>
  (function () {
    const initFallbackTabs = () => {
      if (window.teacherAppReady) return;

      const setActiveTab = (key) => {
        const map = {
          status: document.getElementById('tab-status'),
          task: document.getElementById('tab-task'),
          challenges: document.getElementById('tab-challenges'),
          observation: document.getElementById('tab-observation'),
          student: document.getElementById('tab-student'),
        };
        Object.values(map).forEach(btn => btn && btn.classList.remove('active'));
        if (map[key]) map[key].classList.add('active');
      };

      const showSection = (id, show) => {
        const el = document.getElementById(id);
        if (el) el.style.display = show ? 'block' : 'none';
      };

      const showTab = (key) => {
        const mainBox = document.getElementById('main-box');
        const challengesBox = document.getElementById('challenges-box');

        if (key === 'challenges') {
          setActiveTab('challenges');
          if (mainBox) mainBox.style.display = 'none';
          if (challengesBox) challengesBox.style.display = 'block';
          showSection('student-status-page', false);
          showSection('task-management', false);
          showSection('student-management', false);
          showSection('observation-management', false);
          return;
        }

        if (mainBox) mainBox.style.display = 'block';
        if (challengesBox) challengesBox.style.display = 'none';

        if (key === 'task') {
          setActiveTab('task');
          showSection('student-status-page', false);
          showSection('task-management', true);
          showSection('student-management', false);
          showSection('observation-management', false);
          return;
        }

        if (key === 'observation') {
          setActiveTab('observation');
          showSection('student-status-page', false);
          showSection('task-management', false);
          showSection('student-management', false);
          showSection('observation-management', true);
          return;
        }

        if (key === 'student') {
          setActiveTab('student');
          showSection('student-status-page', false);
          showSection('task-management', false);
          showSection('student-management', true);
          showSection('observation-management', false);
          return;
        }

        setActiveTab('status');
        showSection('student-status-page', true);
        showSection('task-management', false);
        showSection('student-management', false);
        showSection('observation-management', false);
      };

      const openTabFromHash = () => {
        const hash = (location.hash || '').replace('#', '').toLowerCase();
        switch (hash) {
          case 'task':
            showTab('task');
            break;
          case 'challenges':
            showTab('challenges');
            break;
          case 'observation':
            showTab('observation');
            break;
          case 'student':
            showTab('student');
            break;
          case 'status':
          default:
            showTab('status');
            break;
        }
      };

      const navigateToTab = (key) => {
        const targetHash = `#${key}`;
        if (location.hash === targetHash) {
          openTabFromHash();
        } else {
          location.hash = key;
        }
      };

      document.getElementById('tab-status')?.addEventListener('click', () => navigateToTab('status'));
      document.getElementById('tab-task')?.addEventListener('click', () => navigateToTab('task'));
      document.getElementById('tab-challenges')?.addEventListener('click', () => navigateToTab('challenges'));
      document.getElementById('tab-observation')?.addEventListener('click', () => navigateToTab('observation'));
      document.getElementById('tab-student')?.addEventListener('click', () => navigateToTab('student'));
      document.getElementById('tab-tools')?.addEventListener('click', () => {
        window.location.href = 'tool.html';
      });

      openTabFromHash();
      window.addEventListener('hashchange', openTabFromHash);
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFallbackTabs);
    } else {
      initFallbackTabs();
    }
  })();
</script>

  <!-- Supabase CDN -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const { createClient } = supabase;
  const SUPABASE_URL = "https://ndgmjnkunpqkgadcoaex.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kZ21qbmt1bnBxa2dhZGNvYWV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5MTI3MzYsImV4cCI6MjA3MzQ4ODczNn0.qeEGADi6Dsa162Rm0ctrixGn86UMbBVujqXqlmABhYw";
  window.sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

</body>
</html>
