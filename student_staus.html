<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>오늘 할 일 - 학생별 과제 완료 현황</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #fff;
      color: #000;
      text-align: center;
      position: relative;
    }
    header {
      margin-bottom: 30px;
    }
    #logo {
      width: 80px;
      height: auto;
      cursor: pointer;
    }
    #teacher-link {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 12px;
      color: #555;
      cursor: pointer;
      user-select: none;
    }
    .student-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .student-item.done {
      background: #e0f7e0;
    }
    .student-item.not-done {
      background: #f7e0e0;
    }
  </style>
</head>
<body>

  <header>
    <img src="logo.png" alt="오늘 할 일 로고" id="logo" onclick="location.href='index.html';" />
  </header>

  <div id="teacher-link" onclick="location.href='teacher.html';" title="교사용 화면 바로가기">교사용</div>

  <h2>오늘 할 일 - 학생별 과제 완료 현황</h2>

  <div id="student-status-list"></div>

  <script>
    // 학생 정보 로드 함수
    function loadStudents() {
      const raw = localStorage.getItem("students");
      return raw ? JSON.parse(raw) : [];
    }

    // 과제 완료 현황 로드 함수
    function loadAssignments() {
      const assignments = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith("teacherTasks-")) {
          const data = JSON.parse(localStorage.getItem(key));
          assignments.push({ date: key.replace("teacherTasks-", ""), tasks: data.tasks });
        }
      }
      return assignments;
    }

    // 학생별 과제 완료 현황 렌더링 함수
    function renderStudentStatus() {
      const students = loadStudents();
      const assignments = loadAssignments();
      const container = document.getElementById("student-status-list");
      container.innerHTML = "";

      students.forEach(student => {
        const div = document.createElement("div");
        div.className = "student-item";
        div.innerHTML = `<strong>${student.name}</strong><br>`;

        assignments.forEach(assign => {
          const doneTasks = JSON.parse(localStorage.getItem(`doneTasks-${student.name}`) || "{}");
          const completedTasks = assign.tasks.filter(task => doneTasks[task]);
          const statusClass = completedTasks.length === assign.tasks.length ? "done" : "not-done";
          div.innerHTML += `
            <div class="${statusClass}">
              <strong>${assign.date}</strong>: ${assign.tasks.join(", ")}<br>
              완료된 과제: ${completedTasks.join(", ")}
            </div>
          `;
        });

        container.appendChild(div);
      });
    }

    // 페이지 로드 시 학생별 과제 완료 현황 렌더링
    renderStudentStatus();
  </script>

</body>
</html>
