<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>오늘 할 일 - 메인</title>

  <!-- 웹 폰트 (Noto Sans KR) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0f172a;            /* 배경 (슬레이트 네이비) */
      --bg-soft: #111827;       /* 카드 그림자용 */
      --card: #0b1220;          /* 카드 배경 */
      --text: #e5e7eb;          /* 본문 글자 */
      --muted: #9ca3af;         /* 보조글 */
      --brand: #60a5fa;         /* 포커스/포인트 */
      --brand-strong: #3b82f6;
      --ring: rgba(96,165,250,.5);
      --ok: #22c55e;
      --warn: #f59e0b;
      --err: #ef4444;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7fafc;
        --bg-soft:#e5e7eb;
        --card:#ffffff;
        --text:#0f172a;
        --muted:#6b7280;
        --brand:#2563eb;
        --brand-strong:#1d4ed8;
        --ring: rgba(37,99,235,.35);
      }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, #1e3a8a33, transparent 60%),
        radial-gradient(1000px 500px at 110% 10%, #0ea5e933, transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg));
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
    }

    /* 컨테이너 */
    .wrap {
      width: 100%;
      max-width: 440px;
      position: relative;
    }

    /* 상단 헤더 */
    header {
      text-align: center;
      margin-bottom: 18px;
      user-select: none;
    }
    #logo {
      width: 88px;
      height: 88px;
      border-radius: 18px;
      object-fit: cover;
      cursor: pointer;
      box-shadow:
        0 12px 30px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.06);
      transition: transform .15s ease, box-shadow .2s ease;
      background: #111827;
    }
    #logo:hover { transform: translateY(-2px) scale(1.02); }
    #logo:active { transform: translateY(0) scale(0.99); }

    .title {
      margin: 14px 0 0;
      font-weight: 700;
      font-size: 22px;
      letter-spacing: -.2px;
    }
    .subtitle {
      margin-top: 6px;
      font-size: 13px;
      color: var(--muted);
    }

    /* 교사용 버튼(우상단) */
    #teacher-link {
      position: fixed;
      top: 14px;
      right: 14px;
      padding: 8px 12px;
      font-size: 12px;
      color: var(--text);
      background: linear-gradient(180deg, #111827, #0b1220);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 999px;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
      cursor: pointer;
      transition: transform .12s ease, box-shadow .2s ease, border-color .2s ease;
    }
    #teacher-link:hover {
      transform: translateY(-1px);
      border-color: rgba(96,165,250,.5);
      box-shadow: 0 10px 28px rgba(59,130,246,.15);
    }
    #teacher-link:active { transform: translateY(0); }

    /* 카드 */
    .card {
      background: linear-gradient(180deg, var(--card), #0a0f1c);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.06);
      box-shadow:
        0 20px 60px rgba(0,0,0,.35),
        inset 0 1px 0 rgba(255,255,255,.04);
      padding: 22px;
      backdrop-filter: saturate(120%) blur(4px);
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .card:focus-within {
      border-color: var(--ring);
      box-shadow:
        0 24px 70px rgba(59,130,246,.18),
        inset 0 1px 0 rgba(255,255,255,.05);
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin: 6px 2px 8px;
    }
    select, input[type="password"], input[type="text"] {
      width: 100%;
      font-size: 16px;
      color: var(--text);
      background: #0e1626;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 12px 14px;
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease, background .2s ease;
    }
    select:hover, input:hover {
      border-color: rgba(255,255,255,.15);
    }
    select:focus, input:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 4px var(--ring);
      background: #0c1322;
    }
    .field {
      margin-bottom: 14px;
      position: relative;
    }

    /* 비밀번호 토글 */
    .pw-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: 0;
      color: var(--muted);
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
    }
    .pw-toggle:hover { color: var(--text); }

    /* 에러/알림 */
    #error-msg {
      min-height: 18px;
      text-align: center;
      font-size: 13px;
      color: var(--err);
      margin: 6px 0 2px;
    }
    .hint {
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
    .shake {
      animation: shake .28s ease;
    }
    @keyframes shake {
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-6px); }
      40%{ transform: translateX(6px); }
      60%{ transform: translateX(-4px); }
      80%{ transform: translateX(4px); }
    }

    /* 버튼 */
    .btn {
      width: 100%;
      border: 0;
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 16px;
      font-weight: 700;
      color: white;
      background: linear-gradient(180deg, var(--brand), var(--brand-strong));
      box-shadow: 0 12px 30px rgba(37,99,235,.35);
      cursor: pointer;
      transition: transform .08s ease, box-shadow .2s ease, filter .15s ease;
    }
    .btn:hover { filter: brightness(1.03); box-shadow: 0 16px 36px rgba(37,99,235,.42); }
    .btn:active { transform: translateY(1px); box-shadow: 0 8px 22px rgba(37,99,235,.32); }
    .btn[disabled] { opacity:.7; cursor:not-allowed; }

    /* 푸터 */
    .footer {
      margin-top: 14px;
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      user-select: none;
    }

    /* 접근성: 포커스 링 */
    .focus-ring:focus-visible {
      outline: none;
      box-shadow: 0 0 0 4px var(--ring);
      border-color: var(--brand);
    }
  </style>

  <!-- Firebase SDK (현재 코드에서 사용하지 않지만 기존 구성 유지) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js"></script>
  <script>
    // 필요 시 활성화
    // const firebaseConfig = { /* 기존 값 유지 */ };
    // const app = firebase.initializeApp(firebaseConfig);
    // const database = firebase.database();
  </script>
</head>
<body>

  <div id="teacher-link" onclick="location.href='teacher.html';" title="교사용 화면 바로가기">교사용</div>

  <div class="wrap">
    <header>
      <img src="logo.png" alt="오늘 할 일 로고" id="logo" onclick="location.href='index.html';" />
      <h1 class="title">학생 로그인</h1>
      <p class="subtitle">번호와 이름을 확인하고 비밀번호 4자리를 입력하세요.</p>
    </header>

    <main class="card" id="login-card" aria-labelledby="form-title">
      <form id="login-form" novalidate>
        <div class="field">
          <label for="student-select-login">학생 선택</label>
          <select id="student-select-login" class="focus-ring" required>
            <option value="">-- 선택하세요 --</option>
          </select>
        </div>

        <div class="field">
          <label for="password">비밀번호</label>
          <input
            type="password"
            id="password"
            inputmode="numeric"
            pattern="\\d{4}"
            placeholder="비밀번호 4자리"
            maxlength="4"
            autocomplete="current-password"
            class="focus-ring"
            aria-describedby="pw-hint"
          />
          <button type="button" class="pw-toggle" id="togglePw" aria-label="비밀번호 표시 전환">
            <!-- 눈 아이콘 -->
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
            </svg>
          </button>
        </div>

        <div id="error-msg" role="status" aria-live="polite"></div>
        <button id="login-btn" type="submit" class="btn">로그인</button>
        <div class="hint" id="pw-hint">Enter키로도 로그인할 수 있어요.</div>
      </form>
    </main>

    <div class="footer">© 오늘 할 일 onhi</div>
  </div>

  <script>
    // ---------- 데이터 & 로딩 ----------
    function loadStudents() {
      const raw = localStorage.getItem("students");
      const students = raw ? JSON.parse(raw) : [];

      // 번호 오름차순 정렬
      students.sort((a, b) => Number(a.id) - Number(b.id));

      const select = document.getElementById("student-select-login");
      select.innerHTML = '<option value="">-- 선택하세요 --</option>';

      students.forEach(stu => {
        const num = Number(stu.id);
        const option = document.createElement("option");
        option.value = stu.name;
        option.textContent = `${num} ${stu.name}`;
        select.appendChild(option);
      });
    }

    // ---------- UX 보조 ----------
    // 비밀번호 보기/숨기기
    document.getElementById("togglePw").addEventListener("click", () => {
      const pw = document.getElementById("password");
      pw.type = pw.type === "password" ? "text" : "password";
      pw.focus();
    });

    // 캡스락 경고(숫자 위주지만 키보드 실수 대비)
    document.getElementById("password").addEventListener("keydown", (e) => {
      const msg = document.getElementById("error-msg");
      if (e.getModifierState && e.getModifierState("CapsLock")) {
        msg.textContent = "Caps Lock이 켜져 있어요.";
      } else if (msg.textContent === "Caps Lock이 켜져 있어요.") {
        msg.textContent = "";
      }
    });

    // 숫자만 입력
    document.getElementById("password").addEventListener("input", (e) => {
      e.target.value = e.target.value.replace(/[^0-9]/g, "").slice(0, 4);
    });

    // ---------- 로그인 ----------
    function showError(text){
      const msg = document.getElementById("error-msg");
      const card = document.getElementById("login-card");
      msg.textContent = text || "";
      card.classList.remove("shake");
      // reflow to restart animation
      void card.offsetWidth;
      if (text) card.classList.add("shake");
    }

    function setBusy(b){
      const btn = document.getElementById("login-btn");
      btn.disabled = b;
      btn.textContent = b ? "확인 중…" : "로그인";
    }

    function login(){
      const selectedName = document.getElementById("student-select-login").value;
      const inputPassword = document.getElementById("password").value.trim();

      if (!selectedName) { showError("학생을 선택하세요."); return; }
      if (inputPassword.length !== 4) { showError("비밀번호 4자리를 입력하세요."); return; }

      const raw = localStorage.getItem("students");
      const students = raw ? JSON.parse(raw) : [];
      const found = students.find(s => s.name === selectedName && s.password === inputPassword);

      if (found) {
        showError("");
        setBusy(true);
        localStorage.setItem("currentStudent", found.name);
        // 약간의 지연으로 전환 감각 제공
        setTimeout(() => { location.href = "student.html"; }, 200);
      } else {
        showError("학번 또는 비밀번호가 틀렸습니다.");
      }
    }

    // 폼 제출/엔터키
    document.getElementById("login-form").addEventListener("submit", (e) => {
      e.preventDefault();
      login();
    });

    // 초기 로드
    window.addEventListener("load", () => {
      loadStudents();
      // 최근 선택 유지(옵션)
      const last = localStorage.getItem("lastStudentSelection");
      if (last) {
        const sel = document.getElementById("student-select-login");
        if ([...sel.options].some(o => o.value === last)) sel.value = last;
      }
    });

    // 선택 저장(옵션)
    document.getElementById("student-select-login").addEventListener("change", (e)=>{
      localStorage.setItem("lastStudentSelection", e.target.value || "");
    });
  </script>
</body>
</html>

